<!DOCTYPE html>
<html>
    <head>
        <title>CanvasLongShadow Playground</title>
    </head>
    <body>
        <canvas id="canvas" width="1000" height="1000"></canvas>

        <script src="canvas-long-shadow.js"></script>
        <script>
            (function () {
                var canvas = document.getElementById('canvas');

                var ctx = canvas.getContext('2d');

                var patternImage = createPatternImage();

                // Render the shadow cast by drawShape().
                var shadowRenderer = new CanvasLongShadow.Renderer({
                    width: canvas.width,
                    height: canvas.height
                });

                var step = 1;

                function draw() {
                    console.time('draw');
                    ctx.save();

                    ctx.fillStyle = '#195A72';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    shadowRenderer.draw(ctx, {
                        shapeRenderer: drawShape,

                        fillOriginX: canvas.width / 2,
                        fillOriginY: canvas.width / 2,

                        fillStyle: function (ctx) {
                            //return ctx.createPattern(patternImage, 'repeat');
                            var gradient = ctx.createLinearGradient(300, 0, 301, 0);
                            gradient.addColorStop(0, 'rgba(0, 0, 0, 0.5)');
                            gradient.addColorStop(1, 'rgba(0, 0, 0, 0.0)');
                            return gradient;
                        }
                    });

                    step += 0.02;

                    drawShape(ctx);

                    ctx.restore();
                    console.timeEnd('draw');
                }

                function scheduleFrame() {
                    draw();
                    window.requestAnimationFrame(scheduleFrame);
                }

                scheduleFrame();

                function drawShape(ctx) {
                    ctx.translate(canvas.width / 2 + 100, canvas.width / 2 + 100);
                    ctx.rotate(0.15);
                    ctx.fillStyle = '#33B5E5';
                    ctx.fillRect(-100, -100, 200, 200);
                }

                function createPatternImage() {
                    var canvas = document.createElement('canvas');
                    canvas.width = 10;
                    canvas.height = 10;

                    var ctx = canvas.getContext('2d');
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'square';
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                    ctx.beginPath();

                    for (var i = 0; i < 4; ++i) {
                        ctx.moveTo(5 * i, 0);
                        ctx.lineTo(5 * i - 5, 10);
                    }

                    ctx.stroke();

                    return canvas;
                }
            }());

            // (function () {
            //     var canvas = document.getElementById('canvas');

            //     console.time('draw');

            //     var ctx = canvas.getContext('2d');
            //     ctx.fillStyle = '#195A72';
            //     ctx.fillRect(0, 0, 1000, 1000);

            //     var maskCanvas = document.createElement('canvas');
            //     maskCanvas.width = 1000;
            //     maskCanvas.height = 1000;
            //     var maskCtx = maskCanvas.getContext('2d');

            //     (function () {
            //         var strideX = Math.cos(Math.PI / 4);
            //         var strideY = Math.sin(Math.PI / 4);
            //         var iteration;
            //         maskCtx.translate(canvas.width / 2, canvas.width / 2);

            //         for (iteration = 0; iteration < 1000; ++iteration) {
            //             //maskCtx.drawImage(maskShapeCanvas, strideX * iteration, strideY * iteration);
            //             maskCtx.translate(strideX, strideY);
            //             drawShape(maskCtx);
            //         }
            //     }());

            //     ctx.drawImage(maskCanvas, 0, 0);

            //     // Render the actual shape.
            //     ctx.translate(canvas.width / 2, canvas.width / 2);
            //     drawShape(ctx);

            //     console.timeEnd('draw');

            //     function drawShape(ctx) {
            //         ctx.fillStyle = '#33B5E5';
            //         ctx.fillRect(-100, -100, 200, 200);
            //     }
            // }());
        </script>
    </body>
</html>
